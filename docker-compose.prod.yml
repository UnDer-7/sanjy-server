name: sanjy-server-prod
services:
  sanjy_database_prod:
    image: postgres:17-alpine
    container_name: sanJy_database_prod
    restart: unless-stopped
    ports:
      - "5433:5432"
    environment:
      # ADM
      POSTGRES_USER: admin_usr
      POSTGRES_PASSWORD: admin_pass
      POSTGRES_DB: diet_control
    volumes:
      - sanJy_database_prod:/var/lib/postgresql/data
    networks:
      - sanjy-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U admin_usr -d diet_control"]
      interval: 5s
      timeout: 5s
      retries: 5
      start_period: 10s

  sanjy_server:
    image: under7/sanjy-server:0.0.1-SNAPSHOT-graalvm
    container_name: "sanjy_server_jdk"
    restart: no
    ports:
      - "8080:8080"
    volumes:
      - ./.docker_volume/sanjy_server:/app/data
    networks:
      - sanjy-network
    depends_on:
      sanjy_database_prod:
        condition: service_healthy
    environment:
      SANJY_SERVER_PORT: 8080
      SANJY_SERVER_LOGGING_LEVEL: INFO
      SANJY_SERVER_LOGGING_APPENDER: CONSOLE-UNSTRUCTURED
      SANJY_SERVER_LOGGING_FILE_PATH: /app/data/logs
      SANJY_SERVER_DATABASE_JDBC_URL: jdbc:postgresql://sanJy_database_prod:5432/diet_control
      SANJY_SERVER_DATABASE_USERNAME: admin_usr
      SANJY_SERVER_DATABASE_PASSWORD: admin_pass

volumes:
  sanJy_database_prod:
    name: sanJy_database_prod

networks:
  sanjy-network:
    name: sanjy-network
